@* @{
    ViewData["Title"] = "Index";
    var listUserWithRoleAndFaculty = ViewData.Model as IEnumerable<dynamic>;
}

<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>

<div class="input-group mb-3">
    <input type="text" class="form-control" id="searchEmail" placeholder="Search by Email">
    <button class="btn btn-outline-secondary" id="searchBtn">Search</button>
</div>

<table class="table">
    <thead>
        <tr>
            <th>Email</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Image</th>
            <th>Faculty</th>
            <th>Role</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="userTableBody">
        @foreach (var user in listUserWithRoleAndFaculty)
        {
            <tr>
                <td>@user.User.Email</td>
                <td>@user.User.FirstName</td>
                <td>@user.User.LastName</td>
                <td>
                    @if (user.User.Image != null)
                    {
                        <img src="/imageUser/@user.User.Image" width="100" height="100" alt="User Image">
                    }
                    else
                    {
                        <img src="/imageUser/ImageDefaultUser.png" width="100" height="100" alt="User Image">
                    }
                </td>
                <td>@user.FacultyName</td>
                <td>@user.RoleName</td>
                <td>
                    <a asp-action="Edit" asp-route-id="@user.User.Id">Edit</a> |
                    <a asp-action="Details" asp-route-id="@user.User.Id">Details</a> |
                    <a asp-action="Delete" asp-route-id="@user.User.Id">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#searchBtn').click(function () {
                var email = $('#searchEmail').val();
                $.ajax({
                    url: '@Url.Action("Index", "Admins")',
                    type: 'GET',
                    data: { email: email },
                    success: function (data) {
                        $('#userTableBody').html(data);
                    },
                    error: function () {
                        alert('Error occurred while searching.');
                    }
                });
            });
        });
    </script>
}
 *@
@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

<p>
    <a href="/Identity/Account/Register?returnUrl=%2F">Create account</a>
</p>

<div class="input-group mb-3">
    <input type="text" class="form-control" id="searchEmail" placeholder="Search by Email">
    <button class="btn btn-outline-secondary" id="searchBtn">Search</button>
</div>

<table class="table">
    <thead>
        <tr>
            <th>Email</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Image</th>
            <th>Faculty</th>
            <th>Role</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="DataStudent">
    </tbody>
</table>

@section Scripts {
    <script>
        $(document).ready(function () {

            loadData();

            function loadData() {
                var email = $('#searchEmail').val();
                $.ajax({
                    url: '@Url.Action("DataStudent", "Admins")',
                    type: 'GET',
                    data: { email: email },
                    success: function (data) {
                        console.log(data);
                        $('#DataStudent').empty();
                        if (data && data.length > 0) {
                            $.each(data, function (index, user) {
                                var imageSrc = user.user.image ? "/imageUser/" + user.user.image : "/imageUser/ImageDefaultUser.png";
                                var editUrl = `/Admins/Edit/${user.user.id}`;
                                var detailsUrl = `/Admins/Details/${user.user.id}`;
                                var deleteUrl = `/Admins/Delete/${user.user.id}`;
                                var row =
                                    `<tr>
                                            <td>${user.user.email}</td>
                                            <td>${user.user.firstName}</td>
                                            <td>${user.user.lastName}</td>
                                            <td><img src="${imageSrc}" width="100" height="100" alt="User Image"></td>
                                            <td>${user.facultyName}</td>
                                            <td>${user.roleName}</td>
                                            <td>
                                                <a href="${editUrl}">Edit</a> |
                                                <a href="${detailsUrl}">Details</a> |
                                                <form id="deleteForm" action="/Admins/Delete" method="post">
                                                    <input type="hidden" id="id" name="id" value="${user.user.id}">
                                                    <button type="submit" onclick="return confirm('Are you sure you want to delete this user? ${user.user.email}')">Delete</button>
                                                </form>
                                            </td>
                                    </tr>`;
                                $('#DataStudent').append(row);
                            });
                        } else {
                            $('#DataStudent').append('<tr><td colspan="7">No data found.</td></tr>');
                        }
                    },
                    error: function () {
                        alert('Error occurred while searching.');
                    }
                });
            }

            $('#searchBtn').click(function () {
                loadData();
            });
        });
    </script>

}

